#attr query = None
#attr error = None
#attr ip_details = None

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>$title</title>
    <link rel="stylesheet" type="text/css" href="${css_file}"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    #if $rgraph_scripts is not None
        #for js in $rgraph_scripts
            <script  type="text/javascript" src="${rgraph_dir}${js}" ></script>
        #end for
    #end if
  </head>
  <body>
    <div id="container">
        <div id="header">
            <h1><a href="/">BGP Ranking</a></h1>
        </div>
        <div id="menu">
            <form method="post" action=".">
                <div><input type="text" name="query" value="$query"/><input type="submit" value="Submit"/></div>
            </form> <br/>
            <a href="/reload">Reload the report</a>
            <form method="post" action=".">
                <div>
                    <select name="source">
                        <option value="">Select a particular source</option>
                        #for $s in $sources
                            #if $source == $s
                                <option value="${s}" selected>${s}</option>
                            #else
                                <option value="${s}">${s}</option>
                            #end if
                        #end for
                    </select>
                    <input type="submit" value="Submit"/>
                </div>
            </form>
        </div>
        <div id="content">
            #if $error is not None
                <div class="error">$error</div>
            #end if
            #if $query is None
                <table id="hor-minimalist-a">
                    <thead>
                        <tr>
                            <th scope="col" >Timestamp</th>
                            <th scope="col" >ASN</th>
                            <th scope="col" >Rank</th>
                        </tr>
                    </thead>
                    #for $history in $histories
                    <tr>
                        <td>$history[0]</td>
                        <td><a href="/?query=$history[1]">$history[1]</a></td>
                        <td>$history[2]</td>
                    </tr>
                    #end for
                </table>
            #else
                <script type="text/javascript">
                    window.onload = function ()
                        {
                            graph = new RGraph.Line('rank', $ipv4_js, $ipv6_js);
                            graph.Set('chart.gutter', 70);
                            graph.Set('chart.tickmarks', 'circle');
                            graph.Set('chart.shadow', 'true');
                            graph.Set('chart.background.grid.autofit', true);
                            graph.Set('chart.labels', $dates_js);
                            graph.Set('chart.text.angle', 45);
                            graph.Set('chart.linewidth', 1);
                            graph.Set('chart.title', '$query');
                            graph.Set('chart.title.xaxis', 'Date');
                            graph.Set('chart.title.yaxis', 'Rank');
                            graph.Set('chart.ymin', 0);
                            graph.Set('chart.ymax', $max_js);
                            graph.Set('chart.scale.decimals', 5);
                            graph.Set('chart.key', ['IPv4', 'IPv6']);
                            graph.Draw();
                        }
                </script>
                <canvas id="rank" width="900" height="500">[Please wait...]</canvas>
                #if $asn_descs is not None
                    <table id="hor-minimalist-a">
                        <thead>
                            <tr>
                                <th scope="col" >Timestamp</th>
                                <th scope="col" >Owner</th>
                                <th scope="col" >Block</th>
                            </tr>
                        </thead>
                        #for $asn_desc in $asn_descs
                        <tr>
                            <td>$asn_desc[1]</td>
                            <td>$asn_desc[2]</td>
                            <td><a href="/?query=$query;ip_details=$asn_desc[0]">$asn_desc[3]</a></td>
                        </tr>
                        #end for
                    </table>
                    #if $ip_details is not None
                        #if $ip_descs is not None
                            <table id="hor-minimalist-b">
                                <thead>
                                    <tr>
                                        <th scope="col" >Timestamp</th>
                                        <th scope="col" >IP Address</th>
                                        <th scope="col" >List Name</th>
                                        <th scope="col" >Infection type</th>
                                        <th scope="col" >Raw Informations</th>
                                        <th scope="col" >Whois entry</th>
                                    </tr>
                                </thead>
                                #for $ip_desc in $ip_descs
                                <tr>
                                    <td>$ip_desc[0]</td>
                                    <td>$ip_desc[1]</td>
                                    <td>$ip_desc[2]</td>
                                    <td>$ip_desc[3]</td>
                                    <td>$ip_desc[4]</td>
                                    <td><pre>$ip_desc[5]</pre></td>
                                </tr>
                                #end for
                            </table>
                        #end if
                    #end if
                #end if
            #end if
        </div>
        <div id="footer"> Footer </div>
    </div>
  </body>
</html>

